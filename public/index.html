<!DOCTYPE html>
<html>
  <head>
    <meta charset="ja" />
    <link rel="stylesheet" href="lib/onsen/css/onsenui.css" />
    <link rel="stylesheet" href="lib/onsen/css/onsen-css-components.css" />
    <link rel="stylesheet" href="css/main.css">
    <script src="lib/onsen/js/onsenui.min.js"></script>

    <!-- Vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.0"></script>
    <script>
      Vue.config.devtools = true
      // After you create app
      // window.__VUE_DEVTOOLS_GLOBAL_HOOK__.Vue = app.constructor;
    </script>
        <!-- <script src="js/main.js"></script> -->

             <!-- <link rel="stylesheet" href="css/categorystyle.css"> -->
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.js"></script>
        <script type="text/javascript" src="js/category.js"></script>
  </head>
  <body>
    <ons-splitter>
      <!-- The side menu -->
      <ons-splitter-side id="menu" collapse>
        <ons-page>
          <ons-toolbar>
              <!-- <div class="left"><ons-back-button>Page1</ons-back-button></div> -->
              <div class="center">設定</div>
          </ons-toolbar>

          <ons-list> 
            <ons-list-item onclick="loadPage('changeMail.html')" tappable modifier="chevron">
              メール変更
            </ons-list-item>
            <!-- <ons-list-item onclick="loadPage('connect.html')" tappable modifier="chevron">
                連携する
              </ons-list-item> -->
            <ons-list-item onclick="logOut()" tappable modifier="chevron">
              ログアウト
            </ons-list-item>
          </ons-list>
        </ons-page>
      </ons-splitter-side>
    <!-- Everything not in the side menu -->
        <ons-splitter-content>
          <!-- <ons-navigator swipeable id="navigator" page="loading.html"> </ons-navigator> -->
          <ons-navigator swipeable id="navigator" page="login.html"> </ons-navigator>
          <!-- <ons-navigator swipeable id="navigator" page="home.html"> </ons-navigator> -->
        </ons-splitter-content>
      </ons-splitter>

      <ons-template id="loading.html">
          <ons-page id="page">

              <div style="margin: 20px auto; width: 320px;">
                  <ons-progress-bar value="20" secondary-value="95"></ons-progress-bar>
                </div>
            <!-- <ons-progress-circular indeterminate></ons-progress-circular> -->
            <!-- <div ons-loading-placeholder="login.html"> -->
                <!-- <div > -->
                    <!-- <ons-progress-circular class="loading" indeterminate></ons-progress-circular> -->
                <!-- </div> -->
              <!-- </div> -->
              <script>
              // make sure to select the proper progress bar element - in this example we take the first available one
              var progressBar = document.querySelector('ons-progress-bar')[0]; 
              // define the custom event and set the final value of the progress (70) 
              var event = new CustomEvent('updateProgress', {detail: {value: 95}});
              // dispatch the event
              progressBar.dispatchEvent(event);
              </script>
          </ons-page>
        </ons-template>

        <ons-template id="changeMail.html">
            <ons-page id="changeMail">
                <ons-toolbar>
                    <div class="left"><ons-back-button>戻る</ons-back-button></div>
                </ons-toolbar>
                <h2>自分のメールを変更する</h2>
                <div style="margin: 20px auto; width: 320px;">

                        <ons-input
                        id="changeUserMail"
                        placeholder="あなたのメールアドレス"
                        class="loginInput"
                      ></ons-input>
                    <ons-button onclick="changeMail()" class="loginBtn">変更する</ons-button>

                  </div>

                <script>

            </script>
            </ons-page>
          </ons-template>


          <ons-template id="connect.html">
              <ons-page id="connect">
                  <ons-toolbar>
                      <div class="left"><ons-back-button>戻る</ons-back-button></div>
                  </ons-toolbar>
                  <h2>パートナー連携</h2>
                  <div style="margin: 20px auto; width: 320px;">
                      <ons-input
                      id="partnerEmail"
                      placeholder="パートナーのメールアドレス"
                      class="loginInput"
                    ></ons-input>
                    <ons-button onclick="renkei()" class="loginBtn">パートナー登録</ons-button>
                  
                  </div>
              
                  <script>
              
              </script>
              </ons-page>
            </ons-template>

<ons-template id="login.html">
  <ons-page id="login">

    <div style="text-align: center; margin-top: 50px">
      <!-- <h1 class="app-title">かじいく</h1> -->
      <div style="margin: 20px auto; width: 320px;">
        <svg id="titleLogo" data-name="レイヤー 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192.25 261.14"><defs><style>.cls-1,.cls-3,.cls-4{fill:none;}.cls-1,.cls-2,.cls-3,.cls-4{stroke:#ff9124;stroke-miterlimit:10;}.cls-1,.cls-3{stroke-width:6px;}.cls-2,.cls-5{fill:#ff9124;}.cls-2,.cls-4{stroke-width:2px;}.cls-3{stroke-linecap:round;}</style></defs><title>ロゴ</title><circle class="cls-1" cx="105.84" cy="174.73" r="83.41"/><circle class="cls-2" cx="132.12" cy="175.87" r="5.71"/><circle class="cls-2" cx="86.41" cy="175.87" r="5.71"/><path class="cls-3" d="M326.58,338.7s-16.33,12.06-30.86,0" transform="translate(-200.17 -145.91)"/><path class="cls-3" d="M335.66,243.35s7.85,31.71-23.09,49.49" transform="translate(-200.17 -145.91)"/><path class="cls-4" d="M366.05,403.5" transform="translate(-200.17 -145.91)"/><path class="cls-3" d="M271.68,245.63s8.45,37.94-26.23,57.87" transform="translate(-200.17 -145.91)"/><path class="cls-3" d="M306,238.78s6.61,35.52-26.23,57.87" transform="translate(-200.17 -145.91)"/><path class="cls-1" d="M226,297.79a23.6,23.6,0,0,0-9.14-2.29c-9.42,0-13.71,9.15-13.71,18.29s11.43,18.28,20.57,16" transform="translate(-200.17 -145.91)"/><path class="cls-5" d="M240.71,179.31a27.2,27.2,0,0,1-.33,14.68,4.56,4.56,0,0,1-4.49,3.1c-2.18-.23-3.68-2.86-3.52-4.81.3-4.37,2-8.17.29-11.78-1.43-3-3.15-3.43-5.33-3.19-.42,7.51-1.05,15.78-1.32,16.51-1,3-3.18,4.12-5.27,3.58s-3.5-2.35-3.18-5.19c.26-2.25.84-7.51.93-11.91-1.09.49-2,.87-2.53,1-2.48.87-4.26-.14-5-1.67a5.08,5.08,0,0,1,1.53-6.59,34.72,34.72,0,0,1,6.57-2.88,27.36,27.36,0,0,0,.3-3.63c0-2.84,1.73-5.28,4.47-5.4,2-.07,3.45,1.58,3.88,4.16,0,.41.06,1.35,0,2.67a10.42,10.42,0,0,1,3.29.06C235.87,169.11,239,173.13,240.71,179.31Zm9.41-4.67c-1.62,1.36-3.41.46-5.7-.95-2.09-1.32-4.63-3.48-6.38-4.55-2.45-1.45-3-3.16-1.82-5.36s3.1-2.56,5.49-1.29,7.8,5,9.44,7.42C252.2,171.55,251.24,173.77,250.12,174.64Z" transform="translate(-200.17 -145.91)"/><path class="cls-5" d="M269.26,151.24c2.67.14,4.17,1.89,4.62,5.18s.63,15.65,3.17,18.41,6.5,1.77,8.9.24a4.29,4.29,0,0,1,6.39,2.73c.58,2.78-1.28,4.94-5.08,6.81-4.75,2.3-11.09,2.82-15.7-1.16s-6.48-17.31-6.8-26.63C264.67,153.92,266.59,151.15,269.26,151.24Zm13.58-1.86c1.33-.88,2.44-.08,4.31,1.82,2.67,2.69,2.93,4.26,1.42,5.32s-3.93-.57-5.68-3.08C282,152.16,281.51,150.32,282.84,149.38Zm4.93-3.13c1.33-.88,2.91,0,4.6,2.08,1.81,2.26,2.16,3.76.61,4.83-1.79,1.2-3.43-.49-5.14-2.76C286.86,149.13,286.45,147.19,287.77,146.25Z" transform="translate(-200.17 -145.91)"/><path class="cls-5" d="M311.73,156.75c2.43-.65,4.59,1.42,5,4.93C317,164.83,318,169,321,171c2,1.32,3.93.79,4.88,2.39a4.66,4.66,0,0,1-1.26,5.94c-2,1.42-4,1-7.11-.09-3.31-1.25-9.27-6.19-9.39-15.5C308.05,159.85,308.59,157.55,311.73,156.75Zm23.16-1.26c2.79-1.71,6.1,1.08,8,3.93,2.56,3.79,4.52,9.78-.28,11-4.19,1-4.4-3.56-7.83-8.54C333.61,160.09,332.2,157.17,334.89,155.49Z" transform="translate(-200.17 -145.91)"/><path class="cls-5" d="M362.65,166.7c3.88-2.4,14.3-8.09,16.62-9.27s6-1.07,7.21,1.47c1,2.12,1.24,4.39-1.68,6.08-2.19,1.26-15.06,7.48-15.06,7.48.34.45,8.13,12,9.21,14.18s.58,5.09-1.25,6.2c-2.37,1.36-4.28,1.37-6.69-1.13s-8.33-13-10.08-15.7S358.77,169.11,362.65,166.7Z" transform="translate(-200.17 -145.91)"/></svg>
            </div>
      <div style="margin: 20px auto; width: 320px;">
        <form id="loginForm">
        <p>
          <ons-input
            id="email"
            placeholder="メールアドレス"
            class="loginInput"
            type="email"
          ></ons-input>
        </p>

        <p>
          <ons-input
            id="password"
            placeholder="パスワード"
            type="password"
            class="loginInput"
          >
          </ons-input>
        </p>

        <p>
          <ons-button onclick="login()" class="loginBtn">ログイン</ons-button>
        </p>
      </form>
      <p>
          <ons-button onclick="loadPage('signup.html')" class="newAccBtn">アカウントを作成する</ons-button>
        </p>
        </div>
      </div>
    </ons-page>
  </ons-template> 

  <!-- 　home -->
<ons-template id="home.html">
  <ons-page id="home">
    <!-- <script src="js/app.js"></script> -->
    <ons-toolbar id="home-toolbar">
      <div class="center">かじいく</div>
      <div class="left">
        <ons-toolbar-button onclick="openMenu()">
          <ons-icon icon="md-menu"></ons-icon>
        </ons-toolbar-button>
      </div>
    </ons-toolbar>
  
    <ons-tabbar id="home-tabbar" position="top">
      <ons-tab page="requests.html" label="リクエスト"></ons-tab>
      <ons-tab page="completed.html" label="終わったタスク"></ons-tab>
      <ons-tab page="profile.html" label="プロフィール"></ons-tab>
    </ons-tabbar>
    <!-- <ons-button onclick="loadPage('page1.html')">Go to page 1 </ons-button> -->
    <!-- <ons-navigator swipeable id="myNavigator"></ons-navigator> -->
    <!-- <ons-navigator swipeable id="myNavigator" page="page1.html"></ons-navigator> -->
  </ons-page>
</ons-template>

<!-- パパの画面　home -->
<ons-template id="home2.html">
  <ons-page id="home2">
    <!-- <script src="js/app.js"></script> -->
    <ons-toolbar id="home2-toolbar">
      <div class="center">かじいく</div>
      <div class="left">
        <ons-toolbar-button onclick="openMenu()">
          <ons-icon icon="md-menu"></ons-icon>
        </ons-toolbar-button>
      </div>
    </ons-toolbar>
  
    <ons-tabbar id="tabbar2" position="top">
      <ons-tab page="requests2.html" label="リクエスト"></ons-tab>
      <ons-tab page="completed2.html" label="終わったタスク"></ons-tab>
      <ons-tab page="profile2.html" label="プロフィール"></ons-tab>
    </ons-tabbar>
    <!-- <ons-button onclick="loadPage('page1.html')">Go to page 1 </ons-button> -->
    <!-- <ons-navigator swipeable id="myNavigator"></ons-navigator> -->
    <!-- <ons-navigator swipeable id="myNavigator" page="page1.html"></ons-navigator> -->
  </ons-page>
</ons-template>

    <ons-template id="signup.html">
        <ons-page id="signup">

            <ons-toolbar>
                <div class="left"><ons-back-button>ログインに戻る</ons-back-button></div>
            </ons-toolbar>
   
            <h1 class="app-title">サインアップ</h1>

            <div style="margin: 20px auto; width: 320px;">
            <p>
              <ons-input
              id="newEmail"
              placeholder="メールアドレス"
              class="loginInput"
              type="email"
              ></ons-input>
            </p>

            <p>
              <ons-input
              id="newPassword"
              placeholder="パスワード"
              type="password"
              class="loginInput"
              >
              </ons-input>
            </p>
            <p>
                <ons-input
                  id="passwordConfirm"
                  placeholder="もう一度パスワードを入力してください"
                  type="password"
                  class="loginInput"
                >
                </ons-input>
              </p>
              <p>
                  <div class="control">
                      <label class="radio">
                        <input type="radio" name="answer" value="mama">
                        ママ
                      </label>
                      <label class="radio">
                        <input type="radio" name="answer" value="papa">
                        パパ
                      </label>
                    </div>
              </p>
            <p>
              <ons-button onclick="signUp()" class="loginBtn">登録</ons-button>
            </p>
          </div>
        </ons-page>
      </ons-template>

    <template id="requests.html">
      <ons-page id="requests">
          <div style="display:none" id="myUserKey"></div>
          <div style="display:none" id="partnerID"></div>
            <ons-pull-hook id="pull-hook">
              再読み込み
            </ons-pull-hook>
            <h2 style="text-align: center;">おねがいリスト</h2>
            <div id="app">
              <ons-list class="todo-list js-todo-list">

                <!-- <div>{{ item.partnerID }}</div> -->
                <div v-if="!loaded" style="text-align: center; margin-top: 200px">
                     読み込み中...
                  </div>
                <div v-if="loaded">
                    <div v-if="isEmpty">
                        <div class="empty-state">
                            <svg class="checklist-icon"><use href="#checklist-icon"></use></svg>
                            <h3 class="empty-state__title">タスクはありません。</h3>
                            <p class="empty-state__description">「＋」ボタンを押してタスクを作ります。</p>
                          </div>

                    </div>
                    <ons-list-item v-for="item in list" class="todo-item"  :data-modal-id="item.id" >
                        <div :class="item.taskCategory"></div>
                        <span class="todo-itemName">{{item.taskName}}</span>
                      <span class="todo-itemComment">{{item.taskComment}}</span>

                      <!-- <div :class="item.taskCategory"></div> -->
                      <!-- <input id="1566658474566" type="checkbox" class="noDisplay">
                      <label for="1566658474566" class="noDisplay"></label> -->
                      <button class="openDetails" name="showmodalbutton" onclick="showModal(this)">
                          詳細
                      </button>
                      <button class="delete-todo js-delete-todo" onclick="deleteTodo(this)">
                          <svg><use href="#delete-icon"></use></svg>
                        </button>
                        <!-- <button type="submit" onclick="deleteTodo()" class="delete-todo js-delete-todo"> -->
                          </ons-list-item>
                </div>
              </ons-list>

                    </div>
                  <!-- <ons-modal direction="up" class="taskDetailsModal" v-for="item in list"  :data-modal-id="item.id" > -->
                        <ons-modal direction="up" class="taskDetailsModal" >
                    <div style="text-align: center;">
                          <div style="text-align: center; background-color: #fff; height: 50vh; width:80vw; margin: 0 auto; padding: 10px;">
            
                          <p style=" z-index:50; color:#000;">
                            <ons-icon icon="md-spinner" size="28px" spin></ons-icon> 
                            Loading...
                            モーダルウィンドウで詳細を確認します。
                          </p>
                          <!-- <button class="doTaskBtn" onclick="doTask(this)" name="doTaskButton" >了解！</button> -->
                          <button class="closeBtn" onclick="closeModal1()">閉じる</button>
                          </div>
                        </div>
                      </ons-modal>
                      <ons-modal direction="up" class="doTaskConfirmation" v-for="item in list" :data-modal-id="item.id" :id="item.id">
                          <div style="text-align: center;">
                            <div style="text-align: center; background-color: #fff; height: 50vh; width:80vw; margin: 0 auto; padding: 10px;">
              
                            <p style=" z-index:50; color:#000;">
                              <!-- <ons-icon icon="md-spinner" size="28px" spin></ons-icon> --> 
                              <!-- Loading... -->
                              リクエストを完了しました
                            </p>
                            <p>パパありがとう！</p>
                            <button class="closeBtn2 button">閉じる</button>
                            </div>
                          </div>
                        </ons-modal>

      <ons-fab position="bottom right" onclick="loadPage('page1.html')">
          <ons-icon icon="md-plus"></ons-icon>
        </ons-fab>
        <!-- <script src="js/todo.js"></script> -->
        <script src="js/pull-hook.js"></script>

        <script>
                
            var valueofTodo = [];
                    // vue_firebase
                var app = new Vue({
              el: '#app',
              data () {
                return {
                  loaded: false,
                  list: [], // 最新状態はここにコピーされる
                  todo:[],
                  id: null
              
              }
        },
                      
                  created: function() {
 
                      partnerID = "-LoBL5MBnKyC7trYe5_A" ; 
             
                  firebase.database().ref('todolist/'+partnerID ).orderByChild('checked').equalTo(false).on("value",  snapshot => {
                        if (snapshot) {
                        const rootList = snapshot.val();
                        const id = snapshot.key;
                        let list = [];  
            
                          Object.keys(rootList).forEach((val, key) => {
                            rootList[val].id = val
                            list.push(rootList[val])
                          valueofTodo.push(val)
                        })
                     
                  
                        this.list = list;
                        this.loaded = true;
                        } 
                      })
                    },
                    computed: {
                       isEmpty: function () {
                          return jQuery.isEmptyObject(this.list)
                       }
                   },
              });
                  console.log(valueofTodo);

                function showModal(el) {
                  var elname = el.tagName ;
                  // get text of the item that was clicked
                  // console.log(elname);
                  var listItem = el.parentElement.parentElement;
                  // console.log(listItem.outerHTML);
                  var dataKey = listItem.getAttribute('data-modal-id');
                  // console.log(listItem.getAttribute('data-modal-id'));
                  // var todoTextLabel = el.parentElement.querySelector('div.todo-itemName').textContent;
                  var todoTextLabel = el.parentElement.querySelector("div").nextElementSibling.textContent;
                  // console.log(todoTextLabel);
                  // var todoTextComment = el.parentElement.querySelector('div.todo-itemComment').textContent;
                  var todoTextComment = el.parentElement.querySelector('span.todo-itemComment').textContent;
                    var todoTextComment = todoTextComment.replace(/\s+/g, '');
                    if (todoTextComment != "") {
                      todoTextComment = todoTextComment.replace(/\s+/g, '');
                    } else {
                      // console.log(todoTextComment);
                      todoTextComment = "コメントなし"
                    }
                    // console.log(todoTextComment);
            
            
                  var modal = document.querySelector('ons-modal.taskDetailsModal');
            
                    modal.show();
                  // }
            
                  var mText = modal.querySelector('p') ;
                  // console.log(mText);
            
                  mText.innerHTML =  todoTextLabel;
                  mText.innerHTML =  "<div class='noDisplay'>" + dataKey+"</div>"+todoTextLabel;
                  mText.innerHTML += "<br><div class='todo-hLine'></div><br>"+todoTextComment;
  
                }
            
                function closeModal1(el) {
                  var modal1 = document.querySelector('ons-modal.taskDetailsModal');
                  modal1.hide();
                }
            
  
            function doTask(el) {
            // console.log(event.target);
            var modal = document.querySelector('ons-modal.taskDetailsModal');
            
            // console.log(modal)
            var elname = modal.tagName ;
              // get text of the item that was clicked
              // console.log(elname);
              var dataKey = modal.querySelector("div.noDisplay").innerHTML;
              // console.log(dataKey);
      
              var id = dataKey
              // Update checked false to true
                  firebase.database().ref('todolist/'+partnerID +'/'+id).update({
              checked: true,
              reviewed:false,
              revScore: 0
                });
                // console.log("Task ID "+ id + "has been updated successfully")
                // console.log("Added Review variables")
              
              modal.hide();
  
              var modal = document.querySelector('ons-modal.doTaskConfirmation');
  
              modal.show();
          
              var closeButton = document.querySelector('.closeBtn2');
              // console.log(closeButton)
                closeButton.onclick = function(){
                modal.hide();
              };
            }
            
  
          function deleteTodo(el) {
          var target = el.parentElement.parentElement.getAttribute("data-modal-id");
  
          // console.log(target);
          //   myKey ;
          // partnerID;
              // getUserDetails();
              // console.log("In getPoints"+myKey);
              console.log("In getPoints "+partnerID);
  
          let todoRef = firebase.database().ref('todolist/' + partnerID +'/' + target);
              todoRef.remove()
          // console.log("Finished deleting")
                    
        ons.notification.confirm("削除しますか？").then(function(){
          ons.notification.alert("削除しました。");
      });
      }

            
    </script>
      </ons-page>
    </template>


    <template id="requests2.html">
      <ons-page id="requests">
          <div style="display:none" id="myUserKey"></div>
          <div style="display:none" id="partnerID"></div>
            <ons-pull-hook id="pull-hook">
              再読み込み
            </ons-pull-hook>
            <h2 style="text-align: center;">おねがいリスト</h2>
            <div id="app">
              <ons-list class="todo-list js-todo-list">

                <!-- <div>{{ item.partnerID }}</div> -->
                <div v-if="!loaded" style="text-align: center; margin-top: 200px">
                     読み込み中...
                  </div>
                <div v-if="loaded">
                    <div v-if="isEmpty">
                        <div class="empty-state">
                            <svg class="checklist-icon"><use href="#checklist-icon"></use></svg>
                            <h3 class="empty-state__title">タスクはありません。</h3>
                            <p class="empty-state__description">「＋」ボタンを押してタスクを作ります。</p>
                          </div>

                    </div>
                    <ons-list-item v-for="item in list" class="todo-item"  :data-modal-id="item.id" >
                        <div :class="item.taskCategory"></div>
                        <span class="todo-itemName">{{item.taskName}}</span>
                      <span class="todo-itemComment">{{item.taskComment}}</span>

                      <!-- <div :class="item.taskCategory"></div> -->
                      <!-- <input id="1566658474566" type="checkbox" class="noDisplay">
                      <label for="1566658474566" class="noDisplay"></label> -->
                      <button class="openDetails" name="showmodalbutton" onclick="showModal(this)">
                          詳細
                      </button>
                      <!-- <button class="delete-todo js-delete-todo" onclick="deleteTodo(this)">
                          <svg><use href="#delete-icon"></use></svg>
                        </button> -->
                        <!-- <button type="submit" onclick="deleteTodo()" class="delete-todo js-delete-todo"> -->
                          </ons-list-item>
                </div>
              </ons-list>

                    </div>
                  <!-- <ons-modal direction="up" class="taskDetailsModal" v-for="item in list"  :data-modal-id="item.id" > -->
                        <ons-modal direction="up" class="taskDetailsModal" >
                    <div style="text-align: center;">
                          <div style="text-align: center; background-color: #fff; height: 50vh; width:80vw; margin: 0 auto; padding: 10px;">
            
                          <p style=" z-index:50; color:#000;">
                            <ons-icon icon="md-spinner" size="28px" spin></ons-icon> 
                            Loading...
                            モーダルウィンドウで詳細を確認します。
                          </p>
                          <button class="doTaskBtn" onclick="doTask(this)" name="doTaskButton" >完了！</button>
                          <button class="closeBtn" onclick="closeModal1()">閉じる</button>
                          </div>
                        </div>
                      </ons-modal>
                      <ons-modal direction="up" class="doTaskConfirmation" v-for="item in list" :data-modal-id="item.id" :id="item.id">
                          <div style="text-align: center;">
                            <div style="text-align: center; background-color: #fff; height: 50vh; width:80vw; margin: 0 auto; padding: 10px;">
              
                            <p style=" z-index:50; color:#000;">
                              <!-- <ons-icon icon="md-spinner" size="28px" spin></ons-icon> --> 
                              <!-- Loading... -->
                              リクエストを完了しました
                            </p>
                            <p>パパありがとう！</p>
                            <button class="closeBtn2 button">閉じる</button>
                            </div>
                          </div>
                        </ons-modal>

      <!-- <ons-fab position="bottom right" onclick="loadPage('page1.html')">
          <ons-icon icon="md-plus"></ons-icon>
        </ons-fab> -->
        <!-- <script src="js/todo.js"></script> -->
        <script src="js/pull-hook.js"></script>

        <script>
                
            var valueofTodo = [];
                    // vue_firebase
                var app = new Vue({
              el: '#app',
              data () {
                return {
                  loaded: false,
                  list: [], // 最新状態はここにコピーされる
                  todo:[],
                  id: null
              
              }
        },
                      
                  created: function() {
 
                      partnerID = "-LoBL5MBnKyC7trYe5_A" ; 
             
                  firebase.database().ref('todolist/'+partnerID ).orderByChild('checked').equalTo(false).on("value",  snapshot => {
                        if (snapshot) {
                        const rootList = snapshot.val();
                        const id = snapshot.key;
                        let list = [];  
            
                          Object.keys(rootList).forEach((val, key) => {
                            rootList[val].id = val
                            list.push(rootList[val])
                          valueofTodo.push(val)
                        })
                     
                  
                        this.list = list;
                        this.loaded = true;
                        } 
                      })
                    },
                    computed: {
                       isEmpty: function () {
                          return jQuery.isEmptyObject(this.list)
                       }
                   },
              });
                  console.log(valueofTodo);

                function showModal(el) {
                  var elname = el.tagName ;
                  // get text of the item that was clicked
                  // console.log(elname);
                  var listItem = el.parentElement.parentElement;
                  // console.log(listItem.outerHTML);
                  var dataKey = listItem.getAttribute('data-modal-id');
                  // console.log(listItem.getAttribute('data-modal-id'));
                  // var todoTextLabel = el.parentElement.querySelector('div.todo-itemName').textContent;
                  var todoTextLabel = el.parentElement.querySelector("div").nextElementSibling.textContent;
                  // console.log(todoTextLabel);
                  // var todoTextComment = el.parentElement.querySelector('div.todo-itemComment').textContent;
                  var todoTextComment = el.parentElement.querySelector('span.todo-itemComment').textContent;
                    var todoTextComment = todoTextComment.replace(/\s+/g, '');
                    if (todoTextComment != "") {
                      todoTextComment = todoTextComment.replace(/\s+/g, '');
                    } else {
                      // console.log(todoTextComment);
                      todoTextComment = "コメントなし"
                    }
                    // console.log(todoTextComment);
            
            
                  var modal = document.querySelector('ons-modal.taskDetailsModal');
            
                    modal.show();
                  // }
            
                  var mText = modal.querySelector('p') ;
                  // console.log(mText);
            
                  mText.innerHTML =  todoTextLabel;
                  mText.innerHTML =  "<div class='noDisplay'>" + dataKey+"</div>"+todoTextLabel;
                  mText.innerHTML += "<br><div class='todo-hLine'></div><br>"+todoTextComment;
  
                }
            
                function closeModal1(el) {
                  var modal1 = document.querySelector('ons-modal.taskDetailsModal');
                  modal1.hide();
                }
            
  
            function doTask(el) {
            // console.log(event.target);
            var modal = document.querySelector('ons-modal.taskDetailsModal');
            
            // console.log(modal)
            var elname = modal.tagName ;
              // get text of the item that was clicked
              // console.log(elname);
              var dataKey = modal.querySelector("div.noDisplay").innerHTML;
              // console.log(dataKey);
      
              var id = dataKey
              // Update checked false to true
                  firebase.database().ref('todolist/'+partnerID +'/'+id).update({
              checked: true,
              reviewed:false,
              revScore: 0
                });
                // console.log("Task ID "+ id + "has been updated successfully")
                // console.log("Added Review variables")
              
              modal.hide();
  
              var modal = document.querySelector('ons-modal.doTaskConfirmation');
  
              modal.show();
          
              var closeButton = document.querySelector('.closeBtn2');
              // console.log(closeButton)
                closeButton.onclick = function(){
                modal.hide();
              };
            }
            
  
          function deleteTodo(el) {
          var target = el.parentElement.parentElement.getAttribute("data-modal-id");
  
          // console.log(target);
          //   myKey ;
          // partnerID;
              // getUserDetails();
              // console.log("In getPoints"+myKey);
              console.log("In getPoints "+partnerID);
  
          let todoRef = firebase.database().ref('todolist/' + partnerID +'/' + target);
              todoRef.remove()
          // console.log("Finished deleting")
                    
        ons.notification.confirm("削除しますか？").then(function(){
          ons.notification.alert("削除しました。");
      });
      }

            
    </script>
      </ons-page>
    </template>


       <template id="completed.html">
        <ons-page id="completed">
    
          
            <!-- <p>Completed Requests go here.</p> -->

            <h2 style="text-align: center;" >評価待ちタスク</h2>
            <div id="appFin1">
                <ons-list class="todo-list js-todo-list">

                    <div v-if="isEmpty">
                        <div class="empty-state">
                            <h3 class="empty-state__title">タスクはありません。</h3>
                            <p class="empty-state__description">「＋」ボタンを押してタスクを作ります。</p>
                          </div>
  
                    </div>

                  <ons-list-item v-for="item in list" class="todo-item" :class="item.beforeReviewed" :data-modal-id="item.id">
                      <div :class="item.taskCategory"></div>
                      <input id="1566658474566" type="checkbox" class="noDisplay">
                      <!-- <label for="1566658474566" class="tick js-tick  noDisplay"></label> -->
                      <label for="1566658474566" class="noDisplay"></label>
                    <span class="todo-itemName">{{item.taskName}}</span>
                    <span class="todo-itemComment">{{item.taskComment}}</span>
                      <button class="openDetails" name="showmodalbutton" onclick="showModal2(this)">
                          詳細
                      </button>
                      <!-- <button class="delete-todo js-delete-todo" onclick="deleteTodo(this)">
                        <svg><use href="#delete-icon"></use></svg>
                      </button> -->
                  </ons-list-item>
                </ons-list>


              </div>
              <ons-modal direction="up" class="taskDetailsModal2">
                  <div style="text-align: center;">
                    <div style="text-align: center; background-color: #fff; height: 50vh; width:80vw; margin: 0 auto; padding: 10px;">
      
                    <p style=" z-index:50; color:#000;">
                      <!-- <ons-icon icon="md-spinner" size="28px" spin></ons-icon> --> 
                      <!-- Loading... -->
                      モーダルウィンドウで詳細を確認します。
                    </p>
                    
                    <div class="formContainer" >


                    <form class="rating" >

                        <label>
                          
                          <input type="radio" name="stars" value="1" />
                          <!-- <span>1</span> -->
                          <span class="icon">★</span>
                   
                        </label>
                        <label>
                          <input type="radio" name="stars" value="2" />
                          <!-- <span>2</span> -->
                          <span class="icon">★</span>
                          <span class="icon">★</span>
                   
                        </label>
                        <label>
                          <input type="radio" name="stars" value="3" />
                          <!-- <span>3</span> -->
                          <span class="icon">★</span>
                          <span class="icon">★</span>
                          <span class="icon">★</span>   
                          <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 32.167 30.98">

                          </svg></span>
                        </label>
                        <label>
                          <input type="radio" name="stars" value="4" />
                          <!-- <span>4</span> -->
                          <span class="icon">★</span>
                          <span class="icon">★</span>
                          <span class="icon">★</span>
                          <span class="icon">★</span>
                        </label>
                        <label>
                          <input type="radio" name="stars" value="5" />
                          <!-- <span>5</span> -->
                          <span class="icon fiveStars">★</span>
                          <span class="icon fiveStars">★</span>
                          <span class="icon fiveStars">★</span>
                          <span class="icon fiveStars">★</span>
                          <span class="icon fiveStars">★</span>
                        </label>
                        <button class="doTaskBtn" onclick="reviewTask(this)" name="reviewTaskButton" >評価する</button>
                      
                      </form>
                      
                    </div>
                   
                    <button class="closeBtn" onclick="closeModal2()">閉じる</button>
                    </div>
                  </div>
                </ons-modal>
  
                <br>
                <div class="hr"></div>
                <br>
                
                <h2 style="text-align: center;">評価済みタスク</h2>

                <div id="appFin2">
                    <ons-list class="todo-list js-todo-list">
                        <div v-if="isEmpty">
                            <div class="empty-state">
                                <h3 class="empty-state__title">タスクはありません。</h3>
                                <p class="empty-state__description">「＋」ボタンを押してタスクを作ります。</p>
                              </div>
      
                        </div>
                      <ons-list-item v-for="item in list" class="todo-item"  :class="item.afterReviewed"  :data-modal-id="item.id" >
                          <div :class="item.taskCategory"></div>
                          <span class="todo-itemName">{{item.taskName}}</span>
                        <span class="todo-itemComment">{{item.taskComment}}</span>
        
                        <!-- <span>{{item.score}}</span> -->
                        <!-- <span>{{item.reviewed}}</span> -->
                          <button class="openDetails" name="showmodalbutton" onclick="showModal3(this)">
                              詳細
                          </button>
                          <button class="delete-todo js-delete-todo" onclick="deleteTodo(this)">
                            <svg><use href="#delete-icon"></use></svg>
                          </button>
                      </ons-list-item>
                    </ons-list>

                  </div>
                  <ons-modal direction="up" class="taskDetailsModal3">
                      <div style="text-align: center;">
                        <div style="text-align: center; background-color: #fff; height: 50vh; width:80vw; margin: 0 auto; padding: 10px;">
                          


                        <p style=" z-index:50; color:#000;" class="inserttext">
               
                        </p>
                        <!-- <button class="doTaskBtn" onclick="doTask()" name="doTaskButton" >了解！</button> -->
                        <button class="closeBtn" onclick="closeModal3()">閉じる</button>
                      </div>
                    </div>
                  </ons-modal>

 <script>

     // vue_firebase
      var app = new Vue({
          el: '#appFin1',
          data () {
            return {
              list: [], // 最新状態はここにコピーされる
              todo: [],
              id: null,
              reviewed: null,
              score: 0,
            }
          },
          
          created: function() {
            //   myKey ;
              // partnerID;
            // getUserDetails();
            // console.log("In appfin1 "+partnerID);
            firebase.database().ref('todolist/'+partnerID).orderByChild('reviewed').equalTo(false).on("value",  snapshot => {
              if (snapshot) {
                  const rootList = snapshot.val()
                  const id = snapshot.key;
                  let list = [];
                  Object.keys(rootList).forEach((val, key) => {
                    rootList[val].id = val
                    list.push(rootList[val])
                  })
                  this.list = list
          }
        })
      },
      computed: {
           isEmpty: function () {
              return jQuery.isEmptyObject(this.list)
           }
       }
    })

    var app = new Vue({
          el: '#appFin2',
          data () {
            return {
              list: [], // 最新状態はここにコピーされる
              todo: [],
              id: null,
              reviewed: null,
              score: 0,
            }
          },
          
          created: function() {   
     
            // partnerID;
            // getUserDetails();
            // console.log("In appfin2 "+partnerID);
            firebase.database().ref('todolist/'+partnerID).orderByChild('reviewed').equalTo(true).on("value",  snapshot => {

              if (snapshot) {
                  const rootList = snapshot.val()
                  const id = snapshot.key;
                  // console.log(id);
                  let list = []
                  // データオブジェクトを配列に変更する
                  Object.keys(rootList).forEach((val, key) => {
                    rootList[val].id = val
                    list.push(rootList[val])
                  })
                  // vueのdataに突っ込む
                  this.list = list
          }
        })
      },
      computed: {
           isEmpty: function () {
              return jQuery.isEmptyObject(this.list)
           }
       }
    })


              function showModal2(el) {
                var elname = el.tagName ;
              // get text of the item that was clicked
              // console.log(elname);
              var listItem = el.parentElement.parentElement;
              // console.log(listItem.outerHTML);
              var dataKey = listItem.getAttribute('data-modal-id');
              // console.log(listItem.getAttribute('data-modal-id'));

              var todoTextLabel = el.parentElement.querySelector('span.todo-itemName').textContent;
              // console.log(todoTextLabel);

              var todoTextComment = el.parentElement.querySelector('span.todo-itemComment').textContent;
                var todoTextComment = todoTextComment.replace(/\s+/g, '');
                if (todoTextComment != "") {
                  todoTextComment = todoTextComment.replace(/\s+/g, '');
                } else {
                  // console.log(todoTextComment);
                  todoTextComment = "コメントなし"
                }
                // console.log(todoTextComment);
              // display the modal

            var modal = document.querySelector('ons-modal.taskDetailsModal2');
            modal.show();
                   
            var mText = modal.querySelector('p') ;

            mText.innerHTML =  todoTextLabel;
            mText.innerHTML =  "<div class='noDisplay'>" + dataKey+"</div>"+todoTextLabel;
            mText.innerHTML += "<br><div class='todo-hLine'></div><br>"+todoTextComment;

            var closeButton = document.querySelector('.closeBtn2');
                  
          }

          function reviewTask(el) {

            event.preventDefault();
            
            
            // function getScore(){
              // Get the selected score (assuming one was selected)
                var score = document.querySelector('input[name="stars"]:checked').value;
                // alert(score + ' was selected!');
                ons.notification.alert('評価ありがとうございました！');

               score = parseInt(score, 10);
            // }
            // getScore()

          var modal = document.querySelector('ons-modal.taskDetailsModal2');
          var elname = modal.tagName ;
            // get text of the item that was clicked
            // console.log(elname);
            var dataKey = modal.querySelector('.noDisplay').innerHTML;
            // console.log(dataKey);
      
            var id = dataKey
            // Update checked false to true and add score to database
            //  partnerID = "-" ; 

            //   myKey ;
            // partnerID;
            // getUserDetails();
            // console.log("In getPoints"+myKey);
            // console.log("In getPoints "+partnerID);

                firebase.database().ref('todolist/'+partnerID+'/'+id).update({
            reviewed:true,
            revScore: score
              });
              // console.log("Task ID "+ id + "has been updated successfully")
              // console.log("Review has been added")

              // // Update papa's points
            //  partnerID = "-" ; 
              //set user's partnerID to this for testing purposes
              // find users with this partnerID このpartnerIDが持っているユーザーを探して、ポイント情報を更新する。

              firebase.database().ref('usertable/'+partnerID).on("value", snapshot => {
                myPoints = snapshot.val().point; // total points
                console.log(snapshot.key + " had " + snapshot.val().point + " points");

                myPoints += score ; //add the current score to total
                console.log(snapshot.key + " now has " + myPoints + " points");
                // pointContainer.textContent = myPoints; 
              })
              firebase.database().ref('usertable/'+partnerID).update({
                point: myPoints,
              });
            // }
            // reset radio input 
            var  radio = document.querySelector('input[name="stars"]:checked');
            radio.checked = false;

            modal.hide();




          }

          
          function showModal3(el) {
                var elname = el.tagName ;
              // get text of the item that was clicked
              // console.log(elname);
              var listItem = el.parentElement.parentElement;
              // console.log(listItem.outerHTML);
              var dataKey = listItem.getAttribute('data-modal-id');
              // console.log(listItem.getAttribute('data-modal-id'));

              var todoTextLabel = el.parentElement.querySelector('span.todo-itemName').textContent;
              // console.log(todoTextLabel);

              var todoTextComment = el.parentElement.querySelector('span.todo-itemComment').textContent;
                var todoTextComment = todoTextComment.replace(/\s+/g, '');
                if (todoTextComment != "") {
                  todoTextComment = todoTextComment.replace(/\s+/g, '');
                } else {
                  // console.log(todoTextComment);
                  todoTextComment = "コメントなし"
                }
                // console.log(todoTextComment);

                // see the score 
                var modal = document.querySelector('ons-modal.taskDetailsModal3');
               var elname = modal.tagName ;
            // get text of the item that was clicked
            // console.log(elname);
           
            
            firebase.database().ref('todolist/'+partnerID+'/'+dataKey).on("value", snapshot => {
                    thisTaskPoint = snapshot.val().revScore; // total points
                console.log(snapshot.key + " had " + snapshot.val().point + " points");
 
              })
              console.log(dataKey, partnerID, thisTaskPoint)

              // display the modal

            var modal = document.querySelector('ons-modal.taskDetailsModal3');
            modal.show();
                   
            var mText = modal.querySelector('p') ;

            mText.innerHTML =  todoTextLabel;
            mText.innerHTML =  "<div class='noDisplay'>" + dataKey+"</div>"+todoTextLabel;
            mText.innerHTML += "<br><div class='todo-hLine'></div><br>"+todoTextComment;
            mText.innerHTML += "<div class='taskPoint'>"+thisTaskPoint+"</div><div>ポイント</div>";

            var closeButton = document.querySelector('.closeBtn2');
                  
          }
          function closeModal2(el) {
            var modal = document.querySelector('ons-modal.taskDetailsModal2');
            modal.hide();
          }
          function closeModal3(el) {
            var modal = document.querySelector('ons-modal.taskDetailsModal3');
            modal.hide();
          }
                    
       function deleteTodo(el) {
        var target = el.parentElement.parentElement.getAttribute("data-modal-id");

        console.log(target);
        // let partnerID = "" ; 

        //   myKey ;
        // partnerID;
            // getUserDetails();
            // console.log("In getPoints"+myKey);
            // console.log("In getPoints "+partnerID);

        let todoRef = firebase.database().ref('todolist/' + partnerID +'/' + target);
            todoRef.remove()
        // console.log("Finished deleting")
        
        ons.notification.confirm("削除しますか？").then(function(){
                      ons.notification.alert("削除しました。");
                  });
      }

        
            </script>
         
          </ons-page>
          
      </template>

      <template id="completed2.html">
        <ons-page id="completed2">
    
          
            <!-- <p>Completed Requests go here.</p> -->

            <h2 style="text-align: center;" >評価待ちタスク</h2>
            <div id="appFin1">
                <ons-list class="todo-list js-todo-list">

                    <div v-if="isEmpty">
                        <div class="empty-state">
                            <h3 class="empty-state__title">タスクはありません。</h3>
                            <p class="empty-state__description">「＋」ボタンを押してタスクを作ります。</p>
                          </div>
  
                    </div>

                  <ons-list-item v-for="item in list" class="todo-item" :class="item.beforeReviewed" :data-modal-id="item.id">
                      <div :class="item.taskCategory"></div>
                      <input id="1566658474566" type="checkbox" class="noDisplay">
                      <!-- <label for="1566658474566" class="tick js-tick  noDisplay"></label> -->
                      <label for="1566658474566" class="noDisplay"></label>
                    <span class="todo-itemName">{{item.taskName}}</span>
                    <span class="todo-itemComment">{{item.taskComment}}</span>
                      <button class="openDetails" name="showmodalbutton" onclick="showModal2(this)">
                          詳細
                      </button>
                      <!-- <button class="delete-todo js-delete-todo" onclick="deleteTodo(this)">
                        <svg><use href="#delete-icon"></use></svg>
                      </button> -->
                  </ons-list-item>
                </ons-list>


              </div>
              <ons-modal direction="up" class="taskDetailsModal2">
                  <div style="text-align: center;">
                    <div style="text-align: center; background-color: #fff; height: 50vh; width:80vw; margin: 0 auto; padding: 10px;">
      
                    <p style=" z-index:50; color:#000;">
                      <!-- <ons-icon icon="md-spinner" size="28px" spin></ons-icon> --> 
                      <!-- Loading... -->
                      モーダルウィンドウで詳細を確認します。
                    </p>
                    
                    <!-- <div class="formContainer" >


                    <form class="rating" >
                        <label>
                          
                          <input type="radio" name="stars" value="1" /> -->
                          <!-- <span>1</span> -->
                          <!-- <span class="icon">★</span>
                   
                        </label>
                        <label>
                          <input type="radio" name="stars" value="2" />
                          <span>2</span>
                          <span class="icon">★</span>
                          <span class="icon">★</span>
                   
                        </label>
                        <label>
                          <input type="radio" name="stars" value="3" />
                          <span>3</span>
                          <span class="icon">★</span>
                          <span class="icon">★</span>
                          <span class="icon">★</span>
                          <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 32.167 30.98">

                          </svg></span>
                        </label>
                        <label>
                          <input type="radio" name="stars" value="4" />
                          <span>4</span>
                          <span class="icon">★</span>
                          <span class="icon">★</span>
                          <span class="icon">★</span>
                          <span class="icon">★</span>
                        </label>
                        <label>
                          <input type="radio" name="stars" value="5" />
                          <span>5</span>
                          <span class="icon fiveStars">★</span>
                          <span class="icon fiveStars">★</span>
                          <span class="icon fiveStars">★</span>
                          <span class="icon fiveStars">★</span>
                          <span class="icon fiveStars">★</span>
                        </label>
                        <button class="doTaskBtn" onclick="reviewTask(this)" name="reviewTaskButton" >評価する</button>
                      </form>
                      
                    </div>
                    -->
                    <button class="closeBtn" onclick="closeModal2()">閉じる</button>
                    </div>
                  </div>
                </ons-modal>
  
                <br>
                <div class="hr"></div>
                <br>
                
                <h2 style="text-align: center;">評価済みタスク</h2>

                <div id="appFin2">
                    <ons-list class="todo-list js-todo-list">
                        <div v-if="isEmpty">
                            <div class="empty-state">
                                <h3 class="empty-state__title">タスクはありません。</h3>
                                <p class="empty-state__description">「＋」ボタンを押してタスクを作ります。</p>
                              </div>
      
                        </div>
                      <ons-list-item v-for="item in list" class="todo-item"  :class="item.afterReviewed"  :data-modal-id="item.id" >
                          <div :class="item.taskCategory"></div>
                          <span class="todo-itemName">{{item.taskName}}</span>
                        <span class="todo-itemComment">{{item.taskComment}}</span>
        
                        <!-- <span>{{item.score}}</span> -->
                        <!-- <span>{{item.reviewed}}</span> -->
                          <button class="openDetails" name="showmodalbutton" onclick="showModal3(this)">
                              詳細
                          </button>
                          <button class="delete-todo js-delete-todo" onclick="deleteTodo(this)">
                            <svg><use href="#delete-icon"></use></svg>
                          </button>
                      </ons-list-item>
                    </ons-list>

                  </div>
                  <ons-modal direction="up" class="taskDetailsModal3">
                      <div style="text-align: center;">
                        <div style="text-align: center; background-color: #fff; height: 50vh; width:80vw; margin: 0 auto; padding: 10px;">
                          


                        <p style=" z-index:50; color:#000;" class="inserttext">
               
                        </p>
                        <!-- <button class="doTaskBtn" onclick="doTask()" name="doTaskButton" >了解！</button> -->
                        <button class="closeBtn" onclick="closeModal3()">閉じる</button>
                      </div>
                    </div>
                  </ons-modal>

 <script>

     // vue_firebase
      var app = new Vue({
          el: '#appFin1',
          data () {
            return {
              list: [], // 最新状態はここにコピーされる
              todo: [],
              id: null,
              reviewed: null,
              score: 0,
            }
          },
          
          created: function() {
            //   myKey ;
              // partnerID;
            // getUserDetails();
            // console.log("In appfin1 "+partnerID);
            firebase.database().ref('todolist/'+partnerID).orderByChild('reviewed').equalTo(false).on("value",  snapshot => {
              if (snapshot) {
                  const rootList = snapshot.val()
                  const id = snapshot.key;
                  let list = [];
                  Object.keys(rootList).forEach((val, key) => {
                    rootList[val].id = val
                    list.push(rootList[val])
                  })
                  this.list = list
          }
        })
      },
      computed: {
           isEmpty: function () {
              return jQuery.isEmptyObject(this.list)
           }
       }
    })

    var app = new Vue({
          el: '#appFin2',
          data () {
            return {
              list: [], // 最新状態はここにコピーされる
              todo: [],
              id: null,
              reviewed: null,
              score: 0,
            }
          },
          
          created: function() {   
     
            // partnerID;
            // getUserDetails();
            // console.log("In appfin2 "+partnerID);
            firebase.database().ref('todolist/'+partnerID).orderByChild('reviewed').equalTo(true).on("value",  snapshot => {

              if (snapshot) {
                  const rootList = snapshot.val()
                  const id = snapshot.key;
                  // console.log(id);
                  let list = []
                  // データオブジェクトを配列に変更する
                  Object.keys(rootList).forEach((val, key) => {
                    rootList[val].id = val
                    list.push(rootList[val])
                  })
                  // vueのdataに突っ込む
                  this.list = list
          }
        })
      },
      computed: {
           isEmpty: function () {
              return jQuery.isEmptyObject(this.list)
           }
       }
    })


              function showModal2(el) {
                var elname = el.tagName ;
              // get text of the item that was clicked
              // console.log(elname);
              var listItem = el.parentElement.parentElement;
              // console.log(listItem.outerHTML);
              var dataKey = listItem.getAttribute('data-modal-id');
              // console.log(listItem.getAttribute('data-modal-id'));

              var todoTextLabel = el.parentElement.querySelector('span.todo-itemName').textContent;
              // console.log(todoTextLabel);

              var todoTextComment = el.parentElement.querySelector('span.todo-itemComment').textContent;
                var todoTextComment = todoTextComment.replace(/\s+/g, '');
                if (todoTextComment != "") {
                  todoTextComment = todoTextComment.replace(/\s+/g, '');
                } else {
                  // console.log(todoTextComment);
                  todoTextComment = "コメントなし"
                }
                // console.log(todoTextComment);
              // display the modal

            var modal = document.querySelector('ons-modal.taskDetailsModal2');
            modal.show();
                   
            var mText = modal.querySelector('p') ;

            mText.innerHTML =  todoTextLabel;
            mText.innerHTML =  "<div class='noDisplay'>" + dataKey+"</div>"+todoTextLabel;
            mText.innerHTML += "<br><div class='todo-hLine'></div><br>"+todoTextComment;

            var closeButton = document.querySelector('.closeBtn2');
                  
          }

          function reviewTask(el) {

            event.preventDefault();
            
            
            // function getScore(){
              // Get the selected score (assuming one was selected)
                var score = document.querySelector('input[name="stars"]:checked').value;
                // alert(score + ' was selected!');
                ons.notification.alert('評価ありがとうございました！');

               score = parseInt(score, 10);
            // }
            // getScore()

          var modal = document.querySelector('ons-modal.taskDetailsModal2');
          var elname = modal.tagName ;
            // get text of the item that was clicked
            // console.log(elname);
            var dataKey = modal.querySelector('.noDisplay').innerHTML;
            // console.log(dataKey);
      
            var id = dataKey
            // Update checked false to true and add score to database
            //  partnerID = "-" ; 

            //   myKey ;
            // partnerID;
            // getUserDetails();
            // console.log("In getPoints"+myKey);
            // console.log("In getPoints "+partnerID);

                firebase.database().ref('todolist/'+partnerID+'/'+id).update({
            reviewed:true,
            revScore: score
              });
              // console.log("Task ID "+ id + "has been updated successfully")
              // console.log("Review has been added")

              // // Update papa's points
            //  partnerID = "-" ; 
              //set user's partnerID to this for testing purposes
              // find users with this partnerID このpartnerIDが持っているユーザーを探して、ポイント情報を更新する。

              firebase.database().ref('usertable/'+partnerID).on("value", snapshot => {
                myPoints = snapshot.val().point; // total points
                console.log(snapshot.key + " had " + snapshot.val().point + " points");

                myPoints += score ; //add the current score to total
                console.log(snapshot.key + " now has " + myPoints + " points");
                // pointContainer.textContent = myPoints; 
              })
              firebase.database().ref('usertable/'+partnerID).update({
                point: myPoints,
              });
            // }
            // reset radio input 
            var  radio = document.querySelector('input[name="stars"]:checked');
            radio.checked = false;
              
            
              
            modal.hide();




          }

          
          function showModal3(el) {
                var elname = el.tagName ;
              // get text of the item that was clicked
              // console.log(elname);
              var listItem = el.parentElement.parentElement;
              // console.log(listItem.outerHTML);
              var dataKey = listItem.getAttribute('data-modal-id');
              // console.log(listItem.getAttribute('data-modal-id'));

              var todoTextLabel = el.parentElement.querySelector('span.todo-itemName').textContent;
              // console.log(todoTextLabel);

              var todoTextComment = el.parentElement.querySelector('span.todo-itemComment').textContent;
                var todoTextComment = todoTextComment.replace(/\s+/g, '');
                if (todoTextComment != "") {
                  todoTextComment = todoTextComment.replace(/\s+/g, '');
                } else {
                  // console.log(todoTextComment);
                  todoTextComment = "コメントなし"
                }
                // console.log(todoTextComment);

                // see the score 
                var modal = document.querySelector('ons-modal.taskDetailsModal3');
               var elname = modal.tagName ;
            // get text of the item that was clicked
            // console.log(elname);
           
            
            firebase.database().ref('todolist/'+partnerID+'/'+dataKey).on("value", snapshot => {
                    thisTaskPoint = snapshot.val().revScore; // total points
                console.log(snapshot.key + " had " + snapshot.val().point + " points");
 
              })
              console.log(dataKey, partnerID, thisTaskPoint)

              // display the modal

            var modal = document.querySelector('ons-modal.taskDetailsModal3');
            modal.show();
                   
            var mText = modal.querySelector('p') ;

            mText.innerHTML =  todoTextLabel;
            mText.innerHTML =  "<div class='noDisplay'>" + dataKey+"</div>"+todoTextLabel;
            mText.innerHTML += "<br><div class='todo-hLine'></div><br>"+todoTextComment;
            mText.innerHTML += "<div class='taskPoint'>"+thisTaskPoint+"</div><div>ポイント</div>";

            var closeButton = document.querySelector('.closeBtn2');
                  
          }
          function closeModal2(el) {
            var modal = document.querySelector('ons-modal.taskDetailsModal2');
            modal.hide();
          }
          function closeModal3(el) {
            var modal = document.querySelector('ons-modal.taskDetailsModal3');
            modal.hide();
          }
                    
       function deleteTodo(el) {
        var target = el.parentElement.parentElement.getAttribute("data-modal-id");

        console.log(target);
        // let partnerID = "" ; 

        //   myKey ;
        // partnerID;
            // getUserDetails();
            // console.log("In getPoints"+myKey);
            // console.log("In getPoints "+partnerID);

        let todoRef = firebase.database().ref('todolist/' + partnerID +'/' + target);
            todoRef.remove()
        // console.log("Finished deleting")
        
        ons.notification.confirm("削除しますか？").then(function(){
                      ons.notification.alert("削除しました。");
                  });
      }

        
            </script>
         
          </ons-page>
          
      </template>



      <template id="profile.html">
          <ons-page id="profile">
              <script></script>
               <div style="text-align: center;">
              <h1 class="mama-prf">パパのポイント</h1>
              <p id="points" class="text-points"
              onclick="getPoints()">0</p>
              <p id=point--after>ポイント</p>
            </div>

<br>
        <div class="hr"></div>
        <br>
        <h2>パートナーと連携する</h2>
            <div style="margin: 20px auto; width: 320px;">
                <ons-input
                id="partnerEmail"
                placeholder="パートナーのメールアドレス"
                class="loginInput"
              ></ons-input>
              <ons-button onclick="renkei()" class="loginBtn">パートナー登録</ons-button>
            
            <!-- </div>
            <div style="margin: 20px auto; width: 320px;">
                  <ons-input
                  id="changeUserMail"
                  placeholder="あなたのメールアドレス"
                  class="loginInput"
                ></ons-input>
              <ons-button onclick="changeMail()" class="loginBtn">自分のメールを変更する</ons-button>
            </div> -->


            <script>


            var myUID =[];
            function renkei() {
              const partnerEmail = document.querySelector("#partnerEmail").value;
              console.log(partnerEmail);
              // firebase.database().ref("usertable").on("value", function(snapshot){
              //   console.log(snapshot.key);
              // })
              // var ref = db.ref("usertable");
                firebase.database().ref("usertable").orderByChild("email").equalTo(partnerEmail).on("child_added", function(snapshot) {
                  let partnerKey =snapshot.key;
                    console.log(partnerKey);
                    // document.querySelector("div#partnerID").innerHTML = partnerKey ;

                    var user = firebase.auth().currentUser;
                      user.providerData.forEach(function (profile) {
                        const UID = user.uid;

                 
                        
                  firebase.database().ref("usertable").orderByChild("userUID").equalTo(UID).on("child_added", function(snapshot) {
                    myKey = snapshot.key;
                    console.log(myKey);

                    firebase.database().ref('usertable/'+ myKey).on("value", snapshot => {
                        myRole = snapshot.val().role; // total points
                        console.log(snapshot.key + " is " + snapshot.val().role );
                      })
                      if (myRole === "papa" ) {
                        // set partnerID as own user key if user is papa
                        console.log("User is papa");
                            firebase.database().ref('usertable/' + myKey )
                            .update({
                            partnerID: myKey,
                            });
                            firebase.database().ref('usertable/' + partnerKey )
                            .update({
                            partnerID: myKey,
                            });
                      } else if  (myRole === "mama" ) {
                        // set partnerID as partner's key if user is mama
                            console.log("User is mama");  
                            firebase.database().ref('usertable/' + myKey ).update({
                            partnerID: partnerKey,
                            });
                            firebase.database().ref('usertable/' + partnerKey ).update({
                            partnerID: partnerKey,
                            });
                        }
                        ons.notification.alert('ユーザーを連携しました。');

                    });
                  });    
                });
              }
     

            function changeMail() {
              const userEmail = document.querySelector("#changeUserMail").value;
              console.log(userEmail);

              var user = firebase.auth().currentUser;
              var UID = user.uid 

              var currentEmail = firebase.auth().currentUser.email;
              console.log(currentEmail)
              
              user.updateEmail(userEmail).then(function() {
                // Update successful.
                ons.notification.alert('メールを「'+userEmail+'」に変更しました。');

              }).catch(function(error) {
                // An error happened.
                ons.notification.alert('ユーザーメール変更できませんでした。' + error.message + '）');
              });
            }

         
   // Get points and profile details
   function getPoints() {
    //   myKey ;


      partnerID;
    getUserDetails();
    // console.log("In getPoints"+myKey);
    console.log("When getPoints "+partnerID);
//  partnerID = document.querySelector("div#partnerID").innerHTML ;
      // console.log("Partnerid from document"+partnerID)         
    const pointContainer = document.querySelector("#points");
      console.log(pointContainer);

      firebase.database().ref('usertable/'+partnerID).on("value", snapshot => {
        myPoints = snapshot.val().point; // total points
    console.log(snapshot.key + " had " + snapshot.val().point + " points");

        if (!myPoints) {
          myPoints = 0;
        } else {
          console.log("myPoints not read")
        }
        console.log(snapshot.key + " has " + snapshot.val().point + " points");
        pointContainer.textContent = myPoints; 
        

      })

    }
  // in case the document is already rendered
if (document.readyState!='loading') getPoints();
// modern browsers
else if (document.addEventListener) document.addEventListener('DOMContentLoaded', run);
// IE <= 8
else document.attachEvent('onreadystatechange', function(){
    if (document.readyState=='complete') getPoints();
});
      
        
            </script>
            </ons-page>
            
        </template>


        
      <template id="profile2.html">
        <ons-page id="profile2">
            <script></script>
             <div style="text-align: center;">
            <h1 class="papa-prf">パパのポイント</h1>
            <p id="points" class="text-points"
            onclick="getPoints()">0</p>
            <p id=point--after>ポイント</p>
          </div>

<br>
      <div class="hr"></div>
      <br>
      <h2>パートナーと連携する</h2>
          <div style="margin: 20px auto; width: 320px;">
              <ons-input
              id="partnerEmail"
              placeholder="パートナーのメールアドレス"
              class="loginInput"
            ></ons-input>
            <ons-button onclick="renkei()" class="loginBtn">パートナー登録</ons-button>
          
          <!-- </div>
          <div style="margin: 20px auto; width: 320px;">
                <ons-input
                id="changeUserMail"
                placeholder="あなたのメールアドレス"
                class="loginInput"
              ></ons-input>
            <ons-button onclick="changeMail()" class="loginBtn">自分のメールを変更する</ons-button>
          </div> -->


          <script>


          var myUID =[];
          function renkei() {
            const partnerEmail = document.querySelector("#partnerEmail").value;
            console.log(partnerEmail);
            // firebase.database().ref("usertable").on("value", function(snapshot){
            //   console.log(snapshot.key);
            // })
            // var ref = db.ref("usertable");
              firebase.database().ref("usertable").orderByChild("email").equalTo(partnerEmail).on("child_added", function(snapshot) {
                let partnerKey =snapshot.key;
                  console.log(partnerKey);
                  // document.querySelector("div#partnerID").innerHTML = partnerKey ;

                  var user = firebase.auth().currentUser;
                    user.providerData.forEach(function (profile) {
                      const UID = user.uid;




                firebase.database().ref("usertable").orderByChild("userUID").equalTo(UID).on("child_added", function(snapshot) {
                  myKey = snapshot.key;
                  console.log(myKey);

                  firebase.database().ref('usertable/'+ myKey).on("value", snapshot => {
                      myRole = snapshot.val().role; // total points
                      console.log(snapshot.key + " is " + snapshot.val().role );
                    })
                    if (myRole === "papa" ) {
                      // set partnerID as own user key if user is papa
                      console.log("User is papa");
                          firebase.database().ref('usertable/' + myKey )
                          .update({
                          partnerID: myKey,
                          });
                          firebase.database().ref('usertable/' + partnerKey )
                          .update({
                          partnerID: myKey,
                          });
                    } else if  (myRole === "mama" ) {
                      // set partnerID as partner's key if user is mama
                          console.log("User is mama");  
                          firebase.database().ref('usertable/' + myKey ).update({
                          partnerID: partnerKey,
                          });
                          firebase.database().ref('usertable/' + partnerKey ).update({
                          partnerID: partnerKey,
                          });
                      }
                      ons.notification.alert('ユーザーを連携しました。');

                  });
                });    
              });
            }
   

          function changeMail() {
            const userEmail = document.querySelector("#changeUserMail").value;
            console.log(userEmail);

            var user = firebase.auth().currentUser;
            var UID = user.uid

            var currentEmail = firebase.auth().currentUser.email;
            console.log(currentEmail)
            
            user.updateEmail(userEmail).then(function() {
              // Update successful.
              ons.notification.alert('メールを「'+userEmail+'」に変更しました。');

            }).catch(function(error) {
              // An error happened.
              ons.notification.alert('ユーザーメール変更できませんでした。' + error.message + '）');
            });
          }

       
 // Get points and profile details
 function getPoints() {
  //   myKey ;


    partnerID;
  getUserDetails();
  // console.log("In getPoints"+myKey);
  console.log("When getPoints "+partnerID);
//  partnerID = document.querySelector("div#partnerID").innerHTML ;
    // console.log("Partnerid from document"+partnerID)         
  const pointContainer = document.querySelector("#points");
    console.log(pointContainer);

    firebase.database().ref('usertable/'+partnerID).on("value", snapshot => {
      myPoints = snapshot.val().point; // total points
  console.log(snapshot.key + " had " + snapshot.val().point + " points");

      if (!myPoints) {
        myPoints = 0;
      } else {
        console.log("myPoints not read")
      }
      console.log(snapshot.key + " has " + snapshot.val().point + " points");
      pointContainer.textContent = myPoints; 
      

    })

  }
// in case the document is already rendered
if (document.readyState!='loading') getPoints();
// modern browsers
else if (document.addEventListener) document.addEventListener('DOMContentLoaded', run);
// IE <= 8
else document.attachEvent('onreadystatechange', function(){
  if (document.readyState=='complete') getPoints();
});

          </script>
          </ons-page>

      </template>




  <template id="page1.html">
      <ons-page id="page1">
      <ons-toolbar>
        <div class="left"><ons-back-button>リクエスト</ons-back-button></div>
        <div class="center">リクエスト作成</div>
      </ons-toolbar>
      <div class="container">
            <p>リクエスト</p>
          <form class="js-form">
            <ons-list class="toggle" id="clickthis" >
                <ons-list-item tappable modifier="chevron" id="changethis" class="js-todo-selector"
                  >タスクを選ぶ</ons-list-item
                >
              </ons-list>

            <ul class="menu1"><div class="overlay overlay-a "></div>
              <li class="toggle2-a "><span class="toggle2-inner closeMenu ">Close Menu</span>
                <li class="toggle2 toggle2-a"><div class="cRyouri"></div><span class="toggle2-inner">料理</span>
                  <ul class="menu2 " id="cRyouri">
                  <div class="overlay"></div>
                  <li  class="toggle3"><a href="#" class="backToMenu1">Back</a></li>
                  <li class="toggle3"><div class="cRyouri"></div><a href="#" class="selectMenu">食器を洗う</a></li>
                  <li class="toggle3"><div class="cRyouri"></div><a href="#" class="selectMenu">食器を拭く</a></li>
                  <li class="toggle3"><div class="cRyouri"></div><a href="#" class="selectMenu">食器の片付け</a></li>
                  <li class="toggle3"><div class="cRyouri"></div><a href="#" class="selectMenu">朝食を作る</a></li>
                  <li class="toggle3"><div class="cRyouri"></div><a href="#" class="selectMenu">昼食を作る</a></li>
                  <li class="toggle3"><div class="cRyouri"></div><a href="#" class="selectMenu">夕食を作る</a></li>
                  
                </ul>
              </li>
              <li class="toggle2 toggle2-a"><div class="cSouji"></div><span class="toggle2-inner">掃除</span>
                <ul class="menu2" id="cSouji">
                    <div class="overlay"></div>
                  <li  class="toggle3"><a href="#" class="backToMenu1">Back</a></li>
                  <li class="toggle3"><div class="cSouji"></div><a href="#" class="selectMenu">テーブルを拭く</a></li>
                  <li class="toggle3"><div class="cSouji"></div><a href="#" class="selectMenu">掃除機をかける</a></li>
                  <li class="toggle3"><div class="cSouji"></div><a href="#" class="selectMenu">トイレを掃除する</a></li>
                  <li class="toggle3"><div class="cSouji"></div><a href="#" class="selectMenu">お風呂を洗う</a></li>

                </ul>
              </li>
              <li class="toggle2 toggle2-a"><div class="cSentaku"></div><span class="toggle2-inner">洗濯</span>
                <ul class="menu2" id="cSentaku">
                    <div class="overlay"></div>
                    <li  class="toggle3"><a href="#" class="backToMenu1">Back</a></li>
                    <li class="toggle3"><div class="cSentaku"></div><a href="#" class="selectMenu">洗濯物を洗う</a></li>
                    <li class="toggle3"><div class="cSentaku"></div><a href="#" class="selectMenu">洗濯物を干す</a></li>
                    <li class="toggle3"><div class="cSentaku"></div><a href="#" class="selectMenu">洗濯物をたたむ</a></li>
                    <li class="toggle3"><div class="cSentaku"></div><a href="#" class="selectMenu">洗濯物をしまう</a></li>
                </ul>
              </li>
              <li class="toggle2 toggle2-a"><div class="cIkuji"></div><span class="toggle2-inner">育児</span>
                <ul class="menu2" id="cIkuji">
                    <div class="overlay"></div>
                    <li  class="toggle3"><a href="#" class="backToMenu1">Back</a></li>
                  <li class="toggle3"><div class="cIkuji"></div><a href="#" class="selectMenu">おむつを替える</a></li>
                  <li class="toggle3"><div class="cIkuji"></div><a href="#" class="selectMenu">子供の歯磨きをする</a></li>
                  <li class="toggle3"><div class="cIkuji"></div><a href="#" class="selectMenu">子供の着替えをする</a></li>
                  <li class="toggle3"><div class="cIkuji"></div><a href="#" class="selectMenu">子供</a></li>
                </ul>
              </li>
              <li class="toggle2 toggle2-a"><div class="cKaimono"></div><span class="toggle2-inner">買い物</span>
                <ul class="menu2" id="cKaimono">
                    <div class="overlay"></div>
                    <li  class="toggle3"><a href="#" class="backToMenu1">Back</a></li>
                  <li class="toggle3"><div class="cKaimono"></div><a href="#" class="selectMenu">夕食の買い物</a></li>
                  <li class="toggle3"><div class="cKaimono"></div><a href="#" class="selectMenu">おむつを買う</a></li>
                  <li class="toggle3"><div class="cKaimono"></div><a href="#" class="selectMenu">トイレットペーパーを買う</a></li>
                </ul>
              </li>
            </ul>
            

          <br>
          <textarea 
          autofocus
          type="text"
          aria-label="Enter a new todo item"
          placeholder="ここにコメントを書きます" 
          class="js-todo-input" 
          name="request-details" 
          rows="10"></textarea>
          <br>

            <button type="submit" class="submitBtn">
              リクエストする
            </button>
            <div class="warningMsg"></div>
          </form>

        <script src="js/todo.js"></script>



                  <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.js"></script>
                  <script type="text/javascript" src="js/category.js"></script>
            </ons-page>
          </template>


  <!-- firebase -->
  <script src="https://www.gstatic.com/firebasejs/6.3.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>

  <script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-auth.js"></script>
  <script>

      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyAROv7vfjwjisKxhe0rX0N5Q1_rbJB5fx0",
        authDomain: "todoapp-a93bf.firebaseapp.com",
        databaseURL: "https://todoapp-a93bf.firebaseio.com",
        projectId: "todoapp-a93bf",
        storageBucket: "todoapp-a93bf.appspot.com",
        messagingSenderId: "922166981395",
        appId: "1:922166981395:web:55378480a5150ca4"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);


    </script>
    <script src="js/login.js"></script>
    <script src="js/myApp.js"></script>

  </body>
</html>
